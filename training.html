<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFM Training | Course & Quiz</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        .course-section { opacity: 0.5; transition: 0.4s; pointer-events: none; border-left: 6px solid #e2e8f0; }
        .course-section.active { opacity: 1; pointer-events: auto; }
        .completed-badge { display: none; color: #166534; background: #dcfce7; padding: 5px 10px; border-radius: 4px; font-weight: bold; margin-left: 10px; }
        .is-done .completed-badge { display: inline-block; }
        .is-done { border-left: 6px solid #22c55e !important; }
        .progress-bar-container { width: 100%; background: #e2e8f0; height: 12px; border-radius: 10px; overflow: hidden; margin: 20px 0; }
        #progress-fill { width: 0%; height: 100%; background: #3b82f6; transition: 0.5s; }
        
        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px; background: #000; margin: 15px 0; }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }

        /* FAQ Upgrades */
        .faq-search-box { width: 100%; padding: 15px; margin: 20px 0; border-radius: 8px; border: 2px solid #3b82f6; font-size: 1rem; }
        .faq-category-title { background: #f1f5f9; padding: 10px; border-radius: 5px; margin-top: 20px; font-weight: bold; color: #1e293b; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px; }
        .faq-item { background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 8px; }
        .faq-q { padding: 12px; cursor: pointer; font-weight: 600; font-size: 0.95rem; display: flex; justify-content: space-between; }
        .faq-a { padding: 0 12px; max-height: 0; overflow: hidden; transition: 0.3s; color: #475569; border-top: 0 solid #eee; position: relative; }
        .faq-item.open .faq-a { max-height: 200px; padding: 12px; border-top-width: 1px; }
        .copy-btn { position: absolute; right: 10px; bottom: 10px; font-size: 0.7rem; background: #3b82f6; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
        .copy-btn:active { background: #1e40af; }
    </style>
</head>
<body class="locked">
    <div id="access-lock-screen">
        <div class="lock-box">
            <h2 class="lock-title">ðŸ”’ Training Access</h2>
            <input type="password" id="access-password-input" placeholder="Enter work code..." autofocus>
            <button onclick="checkAccessPassword()">Enter Course</button>
        </div>
    </div>
    
    <div id="main-content-wrapper">
        <header>
            <div class="header-content">
                <div class="logo-container">
                    <img src="logo.png" alt="Logo" class="logo">
                    <h1 class="site-title">Clinician <b>Training Hub</b></h1>
                </div>
                <nav class="dropdown-nav">
                    <button class="menu-button" onclick="toggleMenu()">Menu â˜°</button>
                    <div id="dropdown-content" class="dropdown-content">
                        <a href="index.html">Home</a>
                        <a href="training.html" class="active">Training Center</a>
                        <a href="selfPayPrices.html">Self-Pay</a>
                        <a href="visitTypes.html">Visit Types</a>
                    </div>
                </nav>
            </div>
        </header>

        <main class="container">
            <section class="info-card">
                <h2>Course Progress</h2>
                <div class="progress-bar-container"><div id="progress-fill"></div></div>
                <p id="progress-text">0 of 4 steps completed</p>
            </section>

            <section id="mod-1" class="info-card course-section active">
                <h3>Module 1: Workflow Overview <span class="completed-badge">âœ“</span></h3>
                <div class="video-wrapper">
                    <iframe src="https://drive.google.com/file/d/1JcizKHaXQPSWrY5-wICXgQfvQo-4aew_/preview"></iframe>
                </div>
                <button class="menu-button" onclick="completeModule(1)">Mark Module 1 Complete</button>
            </section>

            <section id="mod-2" class="info-card course-section">
                <h3>Module 2: Scheduling Logic <span class="completed-badge">âœ“</span></h3>
                <p>Verify identity, check slot types, and repeat date/time.</p>
                <button class="menu-button" onclick="completeModule(2)">Mark Module 2 Complete</button>
            </section>

            <section id="mod-3" class="info-card course-section">
                <h3>Module 3: Knowledge Check</h3>
                <div class="quiz-question">
                    <p>How do you handle a medical emergency on the phone?</p>
                    <label><input type="radio" name="q1" value="b"> Instruct to dial 911 immediately</label>
                </div>
                <button class="menu-button" onclick="checkQuiz()">Submit Quiz</button>
            </section>

            <section id="mod-4" class="info-card course-section" style="text-align:center;">
                <h3>ðŸŽ‰ Finish Training</h3>
                <input type="text" id="trainee-name" placeholder="Full Name..." style="padding:15px; width:300px; margin-bottom:10px; border-radius:8px; border:1px solid #ccc;"><br>
                <button class="menu-button finish-btn" id="submit-btn" onclick="submitCourse()">Send Completion Email</button>
            </section>

            <section class="info-card">
                <h3>ðŸ“š Knowledge Base (275+ Scenarios)</h3>
                <input type="text" id="faq-search" class="faq-search-box" onkeyup="renderFAQ()" placeholder="Search by keyword (e.g., 'angry', 'insurance', 'telehealth')...">
                <div id="faq-container"></div>
            </section>
        </main>
    </div>
    
    <script src="faq-data.js"></script>
    <script src="script.js"></script>
    <script src="lock.js"></script>
    <script>
        let completed = JSON.parse(localStorage.getItem('cfm_training_progress')) || [];

        function renderFAQ() {
            const container = document.getElementById('faq-container');
            const search = document.getElementById('faq-search').value.toLowerCase();
            container.innerHTML = "";

            // Group by category
            const grouped = faqData.reduce((acc, item) => {
                if (item.q.toLowerCase().includes(search) || item.a.toLowerCase().includes(search)) {
                    if (!acc[item.cat]) acc[item.cat] = [];
                    acc[item.cat].push(item);
                }
                return acc;
            }, {});

            for (const cat in grouped) {
                const catDiv = document.createElement('div');
                catDiv.innerHTML = `<div class="faq-category-title">${cat}</div>`;
                grouped[cat].forEach(item => {
                    const faqDiv = document.createElement('div');
                    faqDiv.className = 'faq-item';
                    faqDiv.innerHTML = `
                        <div class="faq-q" onclick="this.parentElement.classList.toggle('open')">${item.q} <span>+</span></div>
                        <div class="faq-a">
                            ${item.a}
                            <button class="copy-btn" onclick="copyText('${item.a.replace(/'/g, "\\'")}')">Copy Script</button>
                        </div>
                    `;
                    catDiv.appendChild(faqDiv);
                });
                container.appendChild(catDiv);
            }
        }

        function copyText(text) {
            navigator.clipboard.writeText(text);
            alert("Script copied to clipboard!");
        }

        function updateUI() {
            const totalSteps = 4;
            const progressPercent = (completed.length / totalSteps) * 100;
            document.getElementById('progress-fill').style.width = progressPercent + '%';
            for(let i = 1; i <= totalSteps; i++) {
                const section = document.getElementById(`mod-${i}`);
                if (!section) continue;
                if (completed.includes(i)) section.classList.add('is-done');
                if (i === 1 || completed.includes(i-1)) section.classList.add('active');
            }
            if (completed.includes(3)) document.getElementById('submit-btn').style.display = 'inline-block';
        }

        function completeModule(num) {
            if (!completed.includes(num)) {
                completed.push(num);
                localStorage.setItem('cfm_training_progress', JSON.stringify(completed));
                updateUI();
            }
        }

        function checkQuiz() {
            const q1 = document.querySelector('input[name="q1"]:checked')?.value;
            if (q1 === 'b') { completeModule(3); alert("Passed!"); }
            else { alert("Incorrect."); }
        }

        function submitCourse() {
            const name = document.getElementById('trainee-name').value;
            if (!name) return alert("Enter name");
            window.location.href = `mailto:stefan.shturevski@fastpacehealth.com?subject=Complete: ${name}&body=${name} finished on ${new Date().toLocaleString()}`;
            completeModule(4);
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderFAQ();
            updateUI();
        });
    </script>
</body>
</html>
